(()=>{"use strict";var e={876:(e,s,n)=>{n.d(s,{Z6:()=>t,qp:()=>r,E2:()=>o,RK:()=>i,r9:()=>a,WH:()=>c,ru:()=>p,V7:()=>l,ML:()=>d,O8:()=>u,Nb:()=>w,nb:()=>g,dO:()=>h});const t="bd-relaunch-app",r="bd-get-path",o="bd-run-script",i="bd-did-navigate-in-page",a="bd-open-devtools",c="bd-close-devtools",p="bd-toggle-devtools",l="bd-open-window",d="bd-inspect-element",u="bd-minimum-size",w="bd-remove-devtools-message",g="bd-open-dialog",h="bd-register-preload"},447:(e,s,n)=>{n.d(s,{Z:()=>BetterDiscord});const t=require("fs");var r=n.n(t),o=n(622),i=n.n(o),a=n(50),c=n.n(a);const p="fmkadmapgofadopljbjfkapdkoienihi",l=function(){let e="";if(e="win32"===process.platform?i().resolve(process.env.LOCALAPPDATA,"Google/Chrome/User Data"):"linux"===process.platform?i().resolve(process.env.HOME,".config/google-chrome"):"darwin"===process.platform?i().resolve(process.env.HOME,"Library/Application Support/Google/Chrome"):i().resolve(process.env.HOME,".config/chromium"),r().existsSync(e+"/Default"))e+=`/Default/Extensions/${p}`;else{const s=r().readdirSync(e).filter((e=>e.startsWith("Profile")&&!e.endsWith("store")));let n=!1;for(const t of s){const s=`${e}/${t}/Extensions/${p}`;if(r().existsSync(s)){e=s,n=!0;break}}if(!n)return""}if(r().existsSync(e)){const s=r().readdirSync(e);e=i().resolve(e,s[s.length-1])}return r().existsSync(e)?e:""};var d=n(876);const u=c().app.getAppPath(),w=i().resolve(u,"..","build_info.json");let g="";g="win32"===process.platform||"darwin"===process.platform?i().join(c().app.getPath("userData"),".."):process.env.XDG_CONFIG_HOME?process.env.XDG_CONFIG_HOME:i().join(process.env.HOME,".config"),g=i().join(g,"BetterDiscord")+"/";let h=!1;class BetterDiscord{static getWindowPrefs(){if(!r().existsSync(w))return{};const e=require(w),s=i().resolve(g,"data",e.releaseChannel,"windowprefs.json");return r().existsSync(s)?require(s):{}}static getSetting(e,s){if(this._settings)return this._settings[e]?.[s];try{const n=require(w),t=i().resolve(g,"data",n.releaseChannel,"settings.json");return this._settings=require(t)??{},this._settings[e]?.[s]}catch(n){return this._settings={},this._settings[e]?.[s]}}static ensureDirectories(){r().existsSync(g)||r().mkdirSync(g),r().existsSync(i().join(g,"plugins"))||r().mkdirSync(i().join(g,"plugins")),r().existsSync(i().join(g,"themes"))||r().mkdirSync(i().join(g,"themes"))}static async ensureWebpackModules(e){await e.webContents.executeJavaScript("new Promise(resolve => {\n            const check = function() {\n                if (window.webpackJsonp && window.webpackJsonp.flat().flat().length >= 7000) return resolve();\n                setTimeout(check, 100);\n            };\n            check();\n        });")}static async injectRenderer(e){const s=i().join(__dirname,"renderer.js");if(!r().existsSync(s))return;const n=r().readFileSync(s).toString();await e.webContents.executeJavaScript(`\n            (() => {\n                try {\n                    ${n}\n                    return true;\n                } catch {\n                    return false;\n                }\n            })();\n        `)}static setup(e){try{process.env.DISCORD_RELEASE_CHANNEL=require(w).releaseChannel}catch(e){process.env.DISCORD_RELEASE_CHANNEL="stable"}process.env.DISCORD_PRELOAD=e.__originalPreload,process.env.DISCORD_APP_PATH=u,process.env.DISCORD_USER_DATA=c().app.getPath("userData"),process.env.BETTERDISCORD_DATA_PATH=g,e.webContents.on("dom-ready",(()=>{if(!h)return this.injectRenderer(e);c().dialog.showMessageBox({title:"BetterDiscord Crashed",type:"warning",message:"BetterDiscord seems to have crashed your Discord client.",detail:"BetterDiscord has automatically disabled itself temporarily. Try removing all your plugins then restarting Discord."}),h=!1})),e.webContents.on("did-navigate-in-page",(()=>{e.webContents.send(d.RK)})),e.webContents.on("render-process-gone",(()=>{h=!0}))}static disableMediaKeys(){if(!BetterDiscord.getSetting("general","mediaKeys"))return;const e=c().app.commandLine.getSwitchValue("disable-features")||"";c().app.commandLine.appendSwitch("disable-features",(e?",":"")+"HardwareMediaKeyHandling,MediaSessionService")}}BetterDiscord.getSetting("developer","reactDevTools")&&c().app.whenReady().then((async()=>{await class ReactDevTools{static async install(){const e=l();if(e)try{if(!await a.session.defaultSession.loadExtension(e))return}catch(e){}}static async remove(){const e=l();if(e)try{await a.session.defaultSession.removeExtension(e)}catch(e){}}}.install()}))},622:e=>{e.exports=require("path")},50:e=>{e.exports=require("electron")}},s={};function n(t){if(s[t])return s[t].exports;var r=s[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return n.d(s,{a:s}),s},n.d=(e,s)=>{for(var t in s)n.o(s,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},n.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{var e=n(622),s=n.n(e),t=n(50),r=n.n(t);const o=require("module");var i=n.n(o),a=n(876);const c=(e,s)=>{let n;switch(s){case"appPath":n=t.app.getAppPath();break;case"appData":case"userData":case"home":case"cache":case"temp":case"exe":case"module":case"desktop":case"documents":case"downloads":case"music":case"pictures":case"videos":case"recent":case"logs":n=t.app.getPath(s);break;default:n=""}e.returnValue=n},p=()=>{t.app.quit(),t.app.relaunch()},l=async(e,s)=>{try{await e.sender.executeJavaScript(`(() => {try {${s}} catch {}})();`)}catch(e){}},d=e=>e.sender.openDevTools(),u=e=>e.sender.closeDevTools(),w=e=>{e.sender.isDevToolsOpened()?u(e):d(e)},g=(e,s,{windowOptions:n,closeOnUrl:r}={})=>new Promise((e=>{const o=new t.BrowserWindow(n);o.webContents.on("did-navigate",((s,n)=>{n==r&&(o.close(),e())})),o.loadURL(s)})),h=async e=>{if(!e.sender.isDevToolsOpened())for(e.sender.openDevTools();!e.sender.isDevToolsOpened();)await new Promise((e=>setTimeout(e,100)));e.sender.devToolsWebContents.executeJavaScript("DevToolsAPI.enterInspectElementMode();")},m=(e,s,n)=>{t.BrowserWindow.fromWebContents(e.sender).setMinimumSize(s,n)},f=e=>e.sender.removeAllListeners("devtools-opened"),v=(e,s={})=>{const{mode:n="open",openDirectory:r=!1,openFile:o=!0,multiSelections:i=!1,filters:a,promptToCreate:c=!1,defaultPath:p,title:l,showOverwriteConfirmation:d,message:u,showHiddenFiles:w,modal:g=!1}=s,h={open:t.dialog.showOpenDialog,save:t.dialog.showSaveDialog}[n];return h?h.apply(t.dialog,[g&&t.BrowserWindow.fromWebContents(e.sender),{defaultPath:p,filters:a,title:l,message:u,createDirectory:!0,properties:[w&&"showHiddenFiles",r&&"openDirectory",c&&"promptToCreate",r&&"openDirectory",o&&"openFile",i&&"multiSelections",d&&"showOverwriteConfirmation"].filter((e=>e))}].filter((e=>e))):Promise.resolve({error:"Unkown Mode: "+n})},y=(e,s)=>{t.app.commandLine.appendSwitch("preload",s)};var b=n(447);class BrowserWindow extends r().BrowserWindow{constructor(e){if(!(e&&e.webPreferences&&e.webPreferences.preload&&e.title))return super(e);const n=e.webPreferences.preload;e.webPreferences.preload=s().join(__dirname,"preload.js");const t=b.Z.getSetting("window","transparency");"boolean"==typeof t&&t&&(e.transparent=!0,e.backgroundColor="#00000000"),super(e),this.__originalPreload=n,b.Z.setup(this)}}Object.assign(BrowserWindow,r().BrowserWindow);const D=class{static remove(){r().session.defaultSession.webRequest.onHeadersReceived((function(e,s){if(!e.responseHeaders["content-security-policy-report-only"]&&!e.responseHeaders["content-security-policy"])return s({cancel:!1});delete e.responseHeaders["content-security-policy-report-only"],delete e.responseHeaders["content-security-policy"],s({cancel:!1,responseHeaders:e.responseHeaders})}))}};let S;if(process.argv.includes("--vanilla")||(process.env.NODE_OPTIONS="--no-force-async-hooks-checks",t.app.commandLine.appendSwitch("no-force-async-hooks-checks"),class{static patchBrowserWindow(){const e=require.resolve("electron");delete require.cache[e].exports,require.cache[e].exports={...r(),BrowserWindow}}}.patchBrowserWindow(),class IPCMain{static registerEvents(){t.ipcMain.on(a.qp,c),t.ipcMain.on(a.Z6,p),t.ipcMain.on(a.r9,d),t.ipcMain.on(a.WH,u),t.ipcMain.on(a.ru,w),t.ipcMain.on(a.ML,h),t.ipcMain.on(a.O8,m),t.ipcMain.on(a.Nb,f),t.ipcMain.on(a.dO,y),t.ipcMain.handle(a.E2,l),t.ipcMain.handle(a.nb,v),t.ipcMain.handle(a.V7,g)}}.registerEvents(),"win32"==process.platform||"darwin"==process.platform?t.app.once("ready",D.remove):D.remove()),Object.defineProperty(global,"appSettings",{get:()=>S,set(e){e.hasOwnProperty("settings")||(e.settings={}),e.settings.DANGEROUS_ENABLE_DEVTOOLS_ONLY_ENABLE_IF_YOU_KNOW_WHAT_YOURE_DOING=!0,S=e}}),"win32"==process.platform||"darwin"==process.platform){const e=s().join(t.app.getAppPath(),"..","app.asar"),n=require(s().join(e,"package.json"));t.app.setAppPath(e),t.app.name=n.name,i()._load(s().join(e,n.main),null,!0)}if(!process.argv.includes("--vanilla")){n(447).Z.disableMediaKeys()}})()})();